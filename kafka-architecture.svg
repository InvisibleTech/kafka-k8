<?xml version="1.0" encoding="UTF-8"?>
<svg width="1000" height="800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .title { font-family: Arial, sans-serif; font-size: 24px; font-weight: bold; fill: #333; }
      .subtitle { font-family: Arial, sans-serif; font-size: 14px; fill: #666; }
      .box-title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; fill: #fff; }
      .box-text { font-family: Arial, sans-serif; font-size: 12px; fill: #fff; }
      .label { font-family: Arial, sans-serif; font-size: 11px; fill: #444; }
      .port-label { font-family: Arial, sans-serif; font-size: 10px; fill: #666; }
      .arrow { stroke: #666; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .dashed { stroke-dasharray: 5,5; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#666" />
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="500" y="30" class="title" text-anchor="middle">Kafka Cluster Architecture - Rancher Desktop (macOS)</text>
  <text x="500" y="50" class="subtitle" text-anchor="middle">3-Node KRaft Cluster with External Access</text>
  
  <!-- macOS Host Layer -->
  <rect x="50" y="80" width="900" height="180" fill="#E8F5E9" stroke="#4CAF50" stroke-width="2" rx="5"/>
  <text x="70" y="105" class="label" font-weight="bold">macOS Host (localhost)</text>
  
  <!-- Kafbat UI Access -->
  <rect x="80" y="120" width="180" height="70" fill="#FF9800" stroke="#E65100" stroke-width="2" rx="5"/>
  <text x="170" y="145" class="box-title" text-anchor="middle">Web Browser</text>
  <text x="170" y="165" class="box-text" text-anchor="middle">Kafbat UI</text>
  <text x="170" y="180" class="box-text" text-anchor="middle">localhost:30080</text>
  
  <!-- Kafka Clients -->
  <rect x="300" y="120" width="180" height="70" fill="#2196F3" stroke="#0D47A1" stroke-width="2" rx="5"/>
  <text x="390" y="145" class="box-title" text-anchor="middle">Kafka Clients</text>
  <text x="390" y="165" class="box-text" text-anchor="middle">kcat, producers,</text>
  <text x="390" y="180" class="box-text" text-anchor="middle">consumers</text>
  
  <!-- Connection Details -->
  <rect x="520" y="120" width="400" height="70" fill="#F5F5F5" stroke="#999" stroke-width="1" rx="5"/>
  <text x="540" y="140" class="label" font-weight="bold">External Connection Ports:</text>
  <text x="540" y="158" class="port-label">• Broker 0: localhost:30092 (NodePort)</text>
  <text x="540" y="173" class="port-label">• Broker 1: localhost:30093 (NodePort)</text>
  <text x="540" y="188" class="port-label">• Broker 2: localhost:30094 (NodePort)</text>
  
  <!-- Kubernetes Cluster Boundary -->
  <rect x="50" y="290" width="900" height="480" fill="#E3F2FD" stroke="#1976D2" stroke-width="3" rx="5"/>
  <text x="70" y="315" class="label" font-weight="bold" font-size="16">Rancher Desktop Kubernetes Cluster</text>
  
  <!-- Services Layer -->
  <rect x="80" y="340" width="840" height="120" fill="#FFF3E0" stroke="#F57C00" stroke-width="2" rx="5"/>
  <text x="100" y="365" class="label" font-weight="bold">Services Layer</text>
  
  <!-- Headless Service -->
  <rect x="100" y="380" width="150" height="60" fill="#FF6F00" stroke="#E65100" stroke-width="2" rx="5"/>
  <text x="175" y="402" class="box-title" text-anchor="middle">kafka-headless</text>
  <text x="175" y="417" class="box-text" text-anchor="middle" font-size="10">ClusterIP: None</text>
  <text x="175" y="430" class="box-text" text-anchor="middle" font-size="10">Port: 9092</text>
  
  <!-- Regular Service -->
  <rect x="270" y="380" width="150" height="60" fill="#FF6F00" stroke="#E65100" stroke-width="2" rx="5"/>
  <text x="345" y="402" class="box-title" text-anchor="middle">kafka</text>
  <text x="345" y="417" class="box-text" text-anchor="middle" font-size="10">ClusterIP</text>
  <text x="345" y="430" class="box-text" text-anchor="middle" font-size="10">Port: 9092</text>
  
  <!-- External Services -->
  <rect x="440" y="380" width="210" height="60" fill="#FF6F00" stroke="#E65100" stroke-width="2" rx="5"/>
  <text x="545" y="397" class="box-title" text-anchor="middle">External NodePorts</text>
  <text x="545" y="412" class="box-text" text-anchor="middle" font-size="9">kafka-0-ext: 30092</text>
  <text x="545" y="425" class="box-text" text-anchor="middle" font-size="9">kafka-1-ext: 30093</text>
  <text x="545" y="438" class="box-text" text-anchor="middle" font-size="9">kafka-2-ext: 30094</text>
  
  <!-- Kafbat UI Service -->
  <rect x="670" y="380" width="150" height="60" fill="#FF6F00" stroke="#E65100" stroke-width="2" rx="5"/>
  <text x="745" y="402" class="box-title" text-anchor="middle">kafbat-ui</text>
  <text x="745" y="417" class="box-text" text-anchor="middle" font-size="10">NodePort</text>
  <text x="745" y="430" class="box-text" text-anchor="middle" font-size="10">30080 → 8080</text>
  
  <!-- Pods Layer -->
  <rect x="80" y="490" width="840" height="260" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="2" rx="5"/>
  <text x="100" y="515" class="label" font-weight="bold">Pods Layer (StatefulSet)</text>
  
  <!-- Kafka Broker 0 -->
  <rect x="100" y="540" width="200" height="180" fill="#6A1B9A" stroke="#4A148C" stroke-width="2" rx="5"/>
  <text x="200" y="560" class="box-title" text-anchor="middle">kafka-0</text>
  <text x="200" y="580" class="box-text" text-anchor="middle" font-size="10">Role: Broker + Controller</text>
  <text x="200" y="595" class="box-text" text-anchor="middle" font-size="10">Node ID: 0</text>
  <text x="120" y="620" class="box-text" font-size="10">Listeners:</text>
  <text x="120" y="635" class="box-text" font-size="9">• INTERNAL: 9092</text>
  <text x="120" y="650" class="box-text" font-size="9">• CONTROLLER: 9093</text>
  <text x="120" y="665" class="box-text" font-size="9">• EXTERNAL: 9094</text>
  <rect x="115" y="675" width="170" height="35" fill="#4A148C" stroke="#fff" stroke-width="1" rx="3"/>
  <text x="200" y="692" class="box-text" text-anchor="middle" font-size="9">PVC: kafka-data-kafka-0</text>
  <text x="200" y="705" class="box-text" text-anchor="middle" font-size="9">10Gi Storage</text>
  
  <!-- Kafka Broker 1 -->
  <rect x="330" y="540" width="200" height="180" fill="#6A1B9A" stroke="#4A148C" stroke-width="2" rx="5"/>
  <text x="430" y="560" class="box-title" text-anchor="middle">kafka-1</text>
  <text x="430" y="580" class="box-text" text-anchor="middle" font-size="10">Role: Broker + Controller</text>
  <text x="430" y="595" class="box-text" text-anchor="middle" font-size="10">Node ID: 1</text>
  <text x="350" y="620" class="box-text" font-size="10">Listeners:</text>
  <text x="350" y="635" class="box-text" font-size="9">• INTERNAL: 9092</text>
  <text x="350" y="650" class="box-text" font-size="9">• CONTROLLER: 9093</text>
  <text x="350" y="665" class="box-text" font-size="9">• EXTERNAL: 9094</text>
  <rect x="345" y="675" width="170" height="35" fill="#4A148C" stroke="#fff" stroke-width="1" rx="3"/>
  <text x="430" y="692" class="box-text" text-anchor="middle" font-size="9">PVC: kafka-data-kafka-1</text>
  <text x="430" y="705" class="box-text" text-anchor="middle" font-size="9">10Gi Storage</text>
  
  <!-- Kafka Broker 2 -->
  <rect x="560" y="540" width="200" height="180" fill="#6A1B9A" stroke="#4A148C" stroke-width="2" rx="5"/>
  <text x="660" y="560" class="box-title" text-anchor="middle">kafka-2</text>
  <text x="660" y="580" class="box-text" text-anchor="middle" font-size="10">Role: Broker + Controller</text>
  <text x="660" y="595" class="box-text" text-anchor="middle" font-size="10">Node ID: 2</text>
  <text x="580" y="620" class="box-text" font-size="10">Listeners:</text>
  <text x="580" y="635" class="box-text" font-size="9">• INTERNAL: 9092</text>
  <text x="580" y="650" class="box-text" font-size="9">• CONTROLLER: 9093</text>
  <text x="580" y="665" class="box-text" font-size="9">• EXTERNAL: 9094</text>
  <rect x="575" y="675" width="170" height="35" fill="#4A148C" stroke="#fff" stroke-width="1" rx="3"/>
  <text x="660" y="692" class="box-text" text-anchor="middle" font-size="9">PVC: kafka-data-kafka-2</text>
  <text x="660" y="705" class="box-text" text-anchor="middle" font-size="9">10Gi Storage</text>
  
  <!-- Kafbat UI Pod -->
  <rect x="800" y="540" width="100" height="120" fill="#FB8C00" stroke="#E65100" stroke-width="2" rx="5"/>
  <text x="850" y="560" class="box-title" text-anchor="middle" font-size="12">Kafbat UI</text>
  <text x="850" y="580" class="box-text" text-anchor="middle" font-size="9">Pod</text>
  <text x="820" y="605" class="box-text" font-size="9">Port: 8080</text>
  <text x="820" y="625" class="box-text" font-size="9">Connects to</text>
  <text x="820" y="640" class="box-text" font-size="9">all brokers</text>
  <text x="820" y="655" class="box-text" font-size="9">via internal</text>
  
  <!-- Arrows - External Connections -->
  <!-- Browser to Kafbat UI -->
  <path d="M 170 190 L 170 240 L 745 240 L 745 380" class="arrow"/>
  
  <!-- Clients to External Services -->
  <path d="M 390 190 L 390 240 L 545 240 L 545 380" class="arrow"/>
  
  <!-- Service to Pod Connections -->
  <!-- Headless to Brokers -->
  <path d="M 175 440 L 175 480 L 200 480 L 200 540" class="arrow dashed"/>
  <path d="M 175 440 L 175 480 L 430 480 L 430 540" class="arrow dashed"/>
  <path d="M 175 440 L 175 480 L 660 480 L 660 540" class="arrow dashed"/>
  
  <!-- External services to specific brokers -->
  <path d="M 480 440 L 480 470 L 200 470 L 200 540" class="arrow"/>
  <path d="M 545 440 L 545 460 L 430 460 L 430 540" class="arrow"/>
  <path d="M 610 440 L 610 450 L 660 450 L 660 540" class="arrow"/>
  
  <!-- Kafbat UI Service to Pod -->
  <path d="M 745 440 L 745 470 L 850 470 L 850 540" class="arrow"/>
  
  <!-- Inter-broker Communication (Controller Quorum) -->
  <path d="M 300 630 L 330 630" class="arrow dashed" stroke="#FFC107"/>
  <path d="M 530 630 L 560 630" class="arrow dashed" stroke="#FFC107"/>
  
  <!-- Legend -->
  <rect x="50" y="790" width="900" height="5" fill="none"/>
  
</svg>
